{% extends "manager/index.html" %}
{% load util_tags %}

{% block content %}
<h2 class="mb-4">今週のシフト表</h2>

<table class="table table-striped">
  <thead>
    <tr>
      <th>時間帯</th>
      {% for d in week_dates %}
        <th class="text-center">
          {{ d|date:"m/d" }}<br>
          ({{ d|date:"D" }})
        </th>
      {% endfor %}
    </tr>
  </thead>

  <tbody>
    {% for slot in time_slots %}
      <tr>
        <td><strong>{{ slot }}</strong></td>

        {% for d in week_dates %}
          {% with cell=matrix|default_if_none:""|get_item:slot|get_item:d %}
            <td>
              {% if cell %}
                <div><small>定員 {{ cell.capacity }} / 残 {{ cell.remaining }}</small></div>
                <ul class="mb-0 ps-3">
                  {% for r in cell.reservations.all %}
                    <li>{{ r.student_name }}</li>
                  {% empty %}
                    <li class="text-muted">—</li>
                  {% endfor %}
                </ul>
              {% else %}
                <span class="text-muted">—</span>
              {% endif %}
            </td>
          {% endwith %}
        {% endfor %}

      </tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}
